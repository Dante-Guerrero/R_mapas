---
title: "MAIN"
---

```{r include=FALSE, message=FALSE}
source('auxiliares/comprobar_mapas.R')

```

## Graficando un mapa

```{r fig, fig.height = 8, fig.width = 8, fig.align = "center"}

library(sf)
library(ggplot2)
library(ggrepel)
library(dplyr)
library(tidyverse)

mapa <- mapas$departamentos
mapa_c <- st_centroid(mapa) 
mapa_c <- mapa_c %>% 
  mutate(
    lng = unlist(map(mapa_c$geometry,1)),
    lat = unlist(map(mapa_c$geometry,2)),
    nudge_lng = ifelse(mapa_c$lng<(-75), -5, +5)
    )

graph <- ggplot(data=mapa, aes())+
  geom_sf(color="black", fill="greenyellow")+
  ggtitle('Mapa del Perú')+
  #theme_void()+
  theme(
    plot.title = element_text(hjust = 0.5)
    )+
  geom_sf(data = mapas$lago_titicaca, color='black', fill='lightblue')+
  geom_sf(data = mapa_c, color = 'red')+
  geom_text_repel(
    data= mapa_c, aes(x = lng, y = lat, label=DEPARTAMENTO),
    fontface = "bold", 
    size = 3,
    force = 1,
    nudge_x = mapa_c$nudge_lng,
    direction = "both"
    )
graph

para ```


```{r}

md <- mapas$distritos %>% 
  mutate(
    ubigeo = paste(md$DEPARTAMENTO,"-", md$PROVINCIA,"-", md$DISTRITO)
  )

cd <- mapas$calles %>% 
  mutate(
    ubigeo = paste(cd$DEPARTAMENTO,"-", cd$PROVINCIA,"-", cd$DISTR
  )

ubigeo <- intersect(md$ubigeo, cd$ubigeo)
sort(ubigeo)
length(ubigeo)

```

```{r}
departamentos_coincidencia <- intersect(mapas$distritos$DEPARTAMENTO, mapas$calles$DEPARTAMENTO)
departamentos_coincidencia
```
```{r}
provincias_coincidencia <- intersect(mapas$distritos$PROVINCIA, mapas$calles$PROVINCIA)
provincias_diferencia_distritos <- setdiff(mapas$distritos$PROVINCIA, mapas$calles$PROVINCIA)
provincias_diferencia_distritos
provincias_diferencia_calles <- setdiff(mapas$calles$PROVINCIA, mapas$distritos$PROVINCIA)
provincias_diferencia_calles


```

```{r}

distritos <- mapas$distritos

distritos$PROVINCIA[distritos$PROVINCIA == "MARAÑ\u0091ON"] <- "MARAÑON"

distritos

```



```{r}
for(value in ubigeo){
  puntos <- filter(
    rr_sfp,
    rr_UBIGEO== value
  )
  
  plot(st_geometry(md[md_ubigeo==value,]), axes=T, main=value, cex.axis=0.5)
  plot(st_geometry(puntos), add = TRUE,col="red", fill="red")
}
```

























